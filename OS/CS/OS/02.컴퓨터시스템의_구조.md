# 2. 컴퓨터 시스템의 구조

## 운영체제란?

* 컴퓨터 하드웨어 바로 위에 설치되어 사용자 및 다른 모든 소프트웨어와 하드웨어를 연결하는 소프트웨어 계층
  * 협의의 운영체제 (커널)
    * 운영체제의 핵심 부분으로 메모리에 상주하는 부분
  * 광의의 운영체제
    * 커널 뿐 아니라 각종 주변 시스템 유틸리티를 포함한 개념

## 운영 체제의 목적

* 컴퓨터 시스템을 편리하게 사용할 수 있는 환경을 제공
* 컴퓨터 시스템의 자원을 효율적으로 관리
  * 프로세서, 기억장치, 입출력 장치 등의 효율적 관리
    * 사용자간의 형평성 있는 자원 분배
    * 주어진 자원으로 최대한의 성능을 내도록
  * 사용자 및 운영체제 자신의 보호
  * 프로세스, 파일, 메시지 등을 관리


![이미지1](https://github.com/devyoseph/csStudy/blob/master/CS/OS/02.%EC%BB%B4%ED%93%A8%ED%84%B0%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98_%EA%B5%AC%EC%A1%B0.assets/image-20220129001320777.png)

​             

## 운영 체제의 분류

* 동시 작업 가능 여부

  * 단일 작업(single tasking) : 한 번에 하나의 작업만 처리

  * 다중 작업(multi tasking) : 동시에 두 개 이상의 작업 처리

* 사용자의 수
  * 단일 사용자 (single user)
  * 다중 사용자 (multi user)
* 처리 방식
  * 일괄 처리 (batch processing)
    * 작업 요청의 일정량 모아서 한꺼번에 처리
    * 작업이 완전 종료될 때까지 기다려야 함
  * 시분할 (time sharing)
    * 여러 작업을 수행할 때 컴퓨터 처리 능력을 일정한 시간 단위로 분할하여 사용
    * 일괄 처리 시스템에 비해 짧은 응답 시간을 가짐 (ex. UNIX)
    * Interactive 한 방식
  * 실시간 (Realtime OS)
    * 정해진 시간 안에 어떠한 일이 반드시 종료됨이 보장되어야 하는 실시간 시스템을 위한 OS
    * Ex) 원자로/공장 제어, 미사일 제어, 반도체 장비, 로보트 제어
  * 실시간 시스템의 개념 확장
    * Hard realtime system (경성 실시간 시스템)
    * Soft realtime system (연성 실시간 시스템)

## 몇 가지 용어

* 다음 용어들은 컴퓨터에서 여러 작업을 동시에 수행하는 것을 뜻한다.
* Multitasking
* Multiprogramming : 여러 프로그램이 메모리에 올라가 있음을 강조
* Time sharing : CPU의 시간을 분할하여 나누어 쓴다는 의미를 강조
* Multiprocess : 하나의 컴퓨터에 CPU (processor) 가 여러개 붙어있음을 의미

## 운영 체제의 예

* 유닉스(UNIX)
  * 서버를 위한 운영체제
  * 코드의 대부분을 C언어로 작성
  * 높은 이식성
  * 최소한의 커널 구조
  * 복잡한 시스템에 맞게 확장 용이
  * 소스코드 공개
  * 프로그램 개발에 용이
  * 다양한 버전
    * System V, FreeBSD, SunOS, Solaris
    * Linux

* DOS (Disk Operating System)
* MS Windows
* Handheld device 를 위한 OS

## 운영 체제의 구조
![이미지2](https://github.com/devyoseph/csStudy/blob/master/CS/OS/02.%EC%BB%B4%ED%93%A8%ED%84%B0%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98_%EA%B5%AC%EC%A1%B0.assets/image-20220129003508275-3384111.png)

​                

## 컴퓨터 시스템 구조
![이미지3](https://github.com/devyoseph/csStudy/blob/master/CS/OS/02.%EC%BB%B4%ED%93%A8%ED%84%B0%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98_%EA%B5%AC%EC%A1%B0.assets/image-20220129004259054-3384582.png)

​              

### mode bit

* 사용자 프로그램의 잘못된 수행으로 다른 프로그램 및 운영체제에 피해가 가지 않도록 하기 위한 보호장치 필요
* Mode bit을 통해 하드웨어적으로 두 가지 모드의 operation 지원
  * `1` (사용자 모드) : 사용자 프로그램 수행
  * `0` (모니터 모드 = 커널 모드, 시스템 모드) : OS 코드 수행
  * 보안을 해칠 수 있는 중요한 명령어는 모니터 모드에서만 수행 가능한 '특권 명령'으로 규정
  * Interrupt 나 Exception 발생 시 하드웨어가 mode bit 을 0으로 바꿈
  * 사용자 프로그램에서 CPU를 넘기기 전에 mode bit을 1로 셋팅

### registers

* PC (Program Counter) : 다음번 실행할 메모리의 주소를 가지고 있는 레지스터

### Timer

* 정해진 시간이 흐른 뒤 운영체제에게 제어권이 넘어가도록 인터럽트를 발생시킴
* 타이머는 매 클럭 틱 때마다 1씩 감소
* 타이머 값이 0이 되면 타이머 인터럽트 발생
* CPU를 특정 프로그램이 독점하는 것으로부터 보호

> 타이머는 time sharing을 구현하기 위해 널리 이용됨
>
> 타이머는 현재 시간을 계산하기 위해서도 사용

### Interrupt

>  현대의 운영체제는 인터럽트에 의해 구동됨

인터럽트 당한 시점의 레지스터와 program counter를 save 한 후 CPU의 제어를 인터럽트 처리 루틴에 넘긴다.

* Interrupt (하드웨어 인터럽트) : 하드웨어가 발생시킨 인터럽트
* Trap (소프트웨어 인터럽트)
  * Exception : 프로그램이 오류를 범한 경우
  * System call : 프로그램이 커널 함수를 호출하는 경우
* 인터럽트 관련 용어
  * 인터럽트 벡터 : 해당 인터럽트의 처리 루틴 주소를 가지고 있음
  * 인터럽트 처리 루틴 (Interrupt Service Routine, 인터럽트 핸들러)
    * 해당 인터럽트를 처리하는 커널 함수

### 시스템콜(System Call)

* 사용자 프로그램이 운영체제의 서비스를 받기 위해 커널 함수를 호출하는 것

### Device Controller
![이미지4](https://github.com/devyoseph/csStudy/blob/master/CS/OS/02.%EC%BB%B4%ED%93%A8%ED%84%B0%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98_%EA%B5%AC%EC%A1%B0.assets/image-20220129010800321-3386081.png)

​                        

> 운영체제로 CPU가 넘어오는 경우?
>
> * Interrupt line을 셋팅하는 경우
>   * 하드웨어가 intterrupt 걸어서 운영체제로 cpu넘어오는 경우
>   * 소프트웨어가 직접 interrupt (시스템 콜) 걸어서 운영체제로 cpu넘어오는 경우, (ex. I/O 작업 시)
>   * Exception 발생 시



### 동기식 입출력과 비동기식 입출력

> I/O 의 완료는 인터럽트로 알려줌

* 동기식 입출력 (Synchronous I/O)
  * I/O 요청 후 입출력 작업이 완료된 후에야 제어가 사용자 프로그램에 넘어감
  * 구현 방법 1
    * I/O가 끝날 때 까지 CPU를 낭비시킴
    * 매 시점 하나의 I/O만 일어날 수 있음
  * 구현 방법 2
    * I/O가 완료될 때 까지 해당 프로그램에게서 CPU를 빼앗음
    * I/O처리를 기다리는 줄에 그 프로그램을 줄 세움
    * 다른 프로그램에게 CPU를 줌
* 비동기식 입출력 (Asynchronous I/O)
  * I/O 가 시작된 후 입출력 작업이 끝나기를 기다리지 않고 제어가 사용자 프로그램에 즉시 넘어감
  ![이미지5](https://github.com/devyoseph/csStudy/blob/master/CS/OS/02.%EC%BB%B4%ED%93%A8%ED%84%B0%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98_%EA%B5%AC%EC%A1%B0.assets/image-20220129110615911-3421978.png)

​                  

### DMA controller
![이미지6](https://github.com/devyoseph/csStudy/blob/master/CS/OS/02.%EC%BB%B4%ED%93%A8%ED%84%B0%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98_%EA%B5%AC%EC%A1%B0.assets/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202022-01-29%20%EC%98%A4%EC%A0%84%2012.37.50-3422404.png)
        
* DMA (Direct Memory Access)
  * 빠른 입출력 장치를 메모리에 가까운 속도로 처리하기 위해 사용
  * CPU의 중재없이 device controller가 device의 buffer storage의 내용을 메모리에 block단위로 직접 전송
  * 바이트 단위가 아니라 block단위로 인터럽트를 발생시킴

![이미지7](https://github.com/devyoseph/csStudy/blob/master/CS/OS/02.%EC%BB%B4%ED%93%A8%ED%84%B0%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98_%EA%B5%AC%EC%A1%B0.assets/image-20220129111508872.png)

​               

### 서로 다른 입출력 기계어

* I/O 를 수행하는 special instruction에 의해
* Memory Mapped I/O 에 의해

### 저장장치 계층 구조

![이미지8](https://github.com/devyoseph/csStudy/blob/master/CS/OS/02.%EC%BB%B4%ED%93%A8%ED%84%B0%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98_%EA%B5%AC%EC%A1%B0.assets/image-20220129111938832.png)
